
<!DOCTYPE html>

<html>
  <head>
   <!-- Global site tag (gtag.js) - Google Analytics -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=G-QHB6CBHE8P"></script>
   <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QHB6CBHE8P');
   </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skill 3: Building a spider &#8212; LeDataSciFi-2025</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/moviescript.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fin377_specialformatting.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/frontpage.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LeDataSciFi-2025</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about/objectives.html">
   Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/outcomes.html">
   Outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/about_us.html">
   About us + office hours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/structure_and_policies.html">
   Course structure + policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/use_of_gpt.html">
   ChatGPT and other AI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/gradeoverview.html">
   Grading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/interest.html">
   Interested but unsure?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/bootcamp.html">
   Pre-Class Bootcamp
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/hall_of_awesomeness.html">
   The Hall of Awesomeness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about/acknowledgments.html">
   Gratitude
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/04/01b_spiders.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2025"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2025/issues/new?title=Issue%20on%20page%20%2Fcontent/04/01b_spiders.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/LeDataSciFi/ledatascifi-2025/edit/main/content/04/01b_spiders.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LeDataSciFi/ledatascifi-2025/main?urlpath=lab/tree/content/04/01b_spiders.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/LeDataSciFi/ledatascifi-2025/blob/main/content/04/01b_spiders.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-api-hit-is-cool-but-do-you-know-what-s-really-cool">
   One API hit is cool, but  do you know what’s really cool?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-silly-spider">
   A silly spider
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-main-web-scraping-problems-and-workarounds">
   The main web scraping problems (and workarounds)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#would-you-like-another-tutorial-to-try">
     Would you like another tutorial to try?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#credits">
   Credits
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="skill-3-building-a-spider">
<h1>Skill 3: Building a spider<a class="headerlink" href="#skill-3-building-a-spider" title="Permalink to this headline">¶</a></h1>
<p>So, now, we can use python to open a page, pass an API query, and parse a page for the elements we’re interested in.</p>
<div class="section" id="one-api-hit-is-cool-but-do-you-know-what-s-really-cool">
<h2>One API hit is cool, but  do you know what’s really cool?<a class="headerlink" href="#one-api-hit-is-cool-but-do-you-know-what-s-really-cool" title="Permalink to this headline">¶</a></h2>
<p>One million API hits.</p>
<p><img alt="" src="https://media.giphy.com/media/sEULHciNa7tUQ/giphy.gif" /></p>
<p>Ok, maybe not a million.<a class="footnote-reference brackets" href="#mill" id="id1">1</a> But now that you can write a <code class="docutils literal notranslate"><span class="pre">request</span></code> and modify search parameters, you might need to run a bunch of searches.</p>
<p>Scraping jobs typically fall into one of two camps:</p>
<ol class="simple">
<li><p>loop over URLs or some search parameters (like firm names)</p></li>
<li><p>navigate from an initial page through subsequent pages (e.g through search results)</p></li>
</ol>
<p>Of course, both can be true: sometimes a spider might have a list of URLs (search for firms that filed an 8-K in 2000, then those that filed in 2001) and for each URL (year) click through all 8-Ks.</p>
<div class="tip admonition">
<p class="admonition-title">The trick they don’t want you to know</p>
<p><strong>When your job falls into the first camp - you want to loop over a list of URLs - a good way to do that is</strong>: Define a function to do one search, then call that for each search in a list of searches.</p>
</div>
</div>
<div class="section" id="a-silly-spider">
<h2>A silly spider<a class="headerlink" href="#a-silly-spider" title="Permalink to this headline">¶</a></h2>
<p>For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search_itunes</span><span class="p">(</span><span class="n">search_term</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Run one simple iTunes search&#39;&#39;&#39;</span>
    
    <span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://itunes.apple.com/search&#39;</span>
    <span class="n">search_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="n">search_term</span><span class="p">}</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">search_parameters</span><span class="p">)</span>
    
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;results&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">results_df</span>
</pre></div>
</div>
</div>
</div>
<p>We can run this one artist at a time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_itunes</span><span class="p">(</span><span class="s1">&#39;billie eilish&#39;</span><span class="p">)</span>      <span class="c1"># one search at a time</span>
<span class="n">search_itunes</span><span class="p">(</span><span class="s1">&#39;father john misty&#39;</span><span class="p">)</span>  <span class="c1"># &quot;another one&quot; - dj khaled</span>
</pre></div>
</div>
</div>
</div>
<p>Or we can loop over them and <do something> (TBD, but saving the <code class="docutils literal notranslate"><span class="pre">results_df</span></code> to files is a good idea):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;billie eilish&#39;</span><span class="p">,</span><span class="s1">&#39;father john misty&#39;</span><span class="p">]</span> <span class="c1"># you can loop over them!</span>

<span class="c1"># download the results and save locally</span>
<span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">search_itunes</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
    <span class="c1"># you could do anything with the results here</span>
    <span class="c1"># a good idea in many projects: save the webpage/search results</span>
    <span class="c1"># even better: add the saving function inside the &quot;search_itunes&quot; fcn</span>
    <span class="c1"># but this is just a toy illustration, so nothing happens</span>
    <span class="k">pass</span>
    
</pre></div>
</div>
</div>
</div>
<p>LATER, you will want to analyze those files. Just loop over the files again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
    <span class="c1"># load the saved file</span>
    <span class="c1"># call a function you wrote to parse/analyze/reformat one file</span>
    <span class="c1"># do something with the output from the parser</span>
    <span class="c1"># but this is just a toy illustration, so nothing happens    </span>
    <span class="k">pass</span>   
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-main-web-scraping-problems-and-workarounds">
<h2>The main web scraping problems (and workarounds)<a class="headerlink" href="#the-main-web-scraping-problems-and-workarounds" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="01_Intro_to_scraping.html"><span class="doc std std-doc"><em>Also, check out the table from a few pages ago on useful packages and tips.</em></span></a></p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Issue 1:  The jobs are slow<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<p class="card-text">In many web scraping projects, a lot of data needs to get scraped, over thousands (or millions) (or billions) of pages. It’s unlikely that you can do this all in one session. (What if your WiFi disconnects, or Windows decides to do an update, or the webpage freezes you out for a period of time?)</p>
<p class="card-text"><strong>Solutions:</strong></p>
<ol>
<li><p class="card-text"><strong>Write code that only hits the server one time</strong>, and saves the results to your computer. “Step 1” of the <code class="docutils literal notranslate"><span class="pre">search_itunes</span></code> example above does that. Then “step 2” uses/parses those files without going to the webpages again.</p></li>
<li><p class="card-text"><strong>You want your spider to resume, not restart.</strong> Ensure that your code can resume where it left off without having to restart from scratch. My usual solution:</p>
<div class="highlight-PYTHON notranslate"><div class="highlight"><pre><span></span><span class="c1"># as I&#39;m looping over webpages:</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="o">&lt;</span><span class="n">filename</span> <span class="n">this</span> <span class="n">page</span> <span class="n">would</span> <span class="n">get</span><span class="o">&gt;</span><span class="p">):</span> 
    <span class="n">okay_do_the_download</span><span class="p">()</span> <span class="c1"># whatever the function is</span>
<span class="c1"># if not, skip to the next webpage</span>
</pre></div>
</div>
</li>
<li><p class="card-text">Your spider WILL fail - you don’t want it to stop. I typically use a <code class="docutils literal notranslate"><span class="pre">try-except-else</span></code> block. The <code class="docutils literal notranslate"><span class="pre">try</span></code> part accesses the url/send the API request, the <code class="docutils literal notranslate"><span class="pre">except</span></code> part prints or logs a failure to a log file, and the <code class="docutils literal notranslate"><span class="pre">else</span></code> part only executes the code I need to run after the url request if the <code class="docutils literal notranslate"><span class="pre">try</span></code> code was successful. For example, I could improve the <code class="docutils literal notranslate"><span class="pre">search_itunes</span></code> function:</p>
<div class="highlight-PYTHON notranslate"><div class="highlight"><pre><span></span>if not os.path.exists(&lt;filename this page would get&gt;): 
    try:
        r = requests.get(base_url, params = search_parameters)
    except:
        print(&quot;hey this didn&#39;t work! prob print better info than&quot;)
        print(&quot;this string&quot;)
        # or... create strings and append them to an &quot;error_list&quot;,
        # which you save to a text file or csv after the code finishes
        # and you can look at it then
    else:
        results_df = pd.DataFrame(r.json()[&#39;results&#39;])
    ```        
</pre></div>
</div>
</li>
<li><p class="card-text">Your spider WILL fail - you will want to know what. You should log failures, warnings, and errors. The prior example can be adjusted to do this well.</p></li>
</ol>
</div>
</details><details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Issue 2: Too much speed<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<p class="card-text">Servers aren’t free and can get overloaded. You’ve seen or heard of websites crashing due to high traffic - <a class="reference external" href="https://www.blazemeter.com/blog/biggest-web-failures-2016-and-2017-resolutions/">Fandango for Star Wars - Rogue One, Black Fridays, and the Canadian Immigration site in Nov 2016</a>.</p>
<p class="card-text">As such, webmasters often throttle or block computers that are sending too much traffic.</p>
<p class="card-text"><strong>Solutions:</strong></p>
<ol class="simple">
<li><p class="card-text">Slow your code down with <code class="docutils literal notranslate"><span class="pre">sleep(#)</span></code>. This is the main solution.</p></li>
<li><p class="card-text">Get API access with special permissions.</p></li>
<li><p class="card-text">If you can’t slow down your spider (the code crawling the site), use multiple computers/IP addresses</p></li>
</ol>
</div>
</details><details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Issue 3: So… I’m downloading a loooot of files<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<p class="card-text">You are!</p>
<p class="card-text">It’s important to save them in an organized way. There is no “one way”, and the directory/storage scheme I choose depends on the job. The main thing is that you probably want two abilities after the download:</p>
<ol class="simple">
<li><p class="card-text">If you sequentially open all files, can you tell what they are? (E.g. the firm, the year, the form type.)</p></li>
<li><p class="card-text">If you want to only open some files, can you do that without opening all files? (E.g. only open 10-Ks but not 10-Qs.)</p></li>
</ol>
<p class="card-text">How you achieve these is somewhat up to you but you basically have two choices (and these can work in tandom):</p>
<p class="card-text"><strong>Solution 1: Build the folder structure so that the path to the file tells you what you need to know.</strong></p>
<p class="card-text">E.g. <code class="docutils literal notranslate"><span class="pre">/gvkey_10145/10-ks/2008/934573495-923875934.txt</span></code> is “obviously” the 2008 10-K for firm 10145, and you know this without needing to open the file and even though the filename itself is not very clear.</p>
<p class="card-text"><strong>Solution 2: Keep a master list of documents</strong></p>
<p class="card-text">Sometimes it’s not possible or reasonable to know exactly how to build the directory in advance. For example, forms filed to the SEC in 2008 are often for fiscal year 2007. So what does the “2008” folder mean? How can you tell before running everything? So maybe you just download all the 10-ks for that firm inside the <code class="docutils literal notranslate"><span class="pre">/gvkey_10145/10-ks/</span></code> folder.</p>
<p class="card-text">To find the 2008 10-K, you’d open up a master list of documents that contains variables with enough info to assemble the path to each file, and info about each file. Then you can <code class="docutils literal notranslate"><span class="pre">query(&quot;form='10-K'</span> <span class="pre">&amp;</span> <span class="pre">fyear=2008&quot;)</span></code>, assemble the filename, and run your code.</p>
<p class="card-text">This master list must either be assembled before you run your spider (like in Assignment 5), as you run the spider (collect the info and save it as you go), or after the download you run some code one time to assemble it (either using their paths a la <code class="docutils literal notranslate"><span class="pre">/gvkey_10145/10-ks/2008/934573495-923875934.txt</span></code>, or open every single file to extract the info about the document).</p>
</div>
</details><div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>You can combine all this discussion into a “general structure” for spiders. For each page you want to visit, you need to know</p>
<ol class="simple">
<li><p>The URL (or the search term)</p></li>
<li><p>The folder and filename you want to save it to</p></li>
</ol>
<p>And then, for each page you want to visit you’ll run this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">one_search</span><span class="p">(</span><span class="o">&lt;</span><span class="n">the</span> <span class="n">url</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">filename</span> <span class="n">this</span> <span class="n">page</span> <span class="n">would</span> <span class="n">get</span><span class="o">&gt;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="o">&lt;</span><span class="n">filename</span> <span class="n">this</span> <span class="n">page</span> <span class="n">would</span> <span class="n">get</span><span class="o">&gt;</span><span class="p">):</span> 
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">&lt;</span><span class="n">the</span> <span class="n">url</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># log the error somehow</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># save the results, I typically save the RAW source </span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># be nice to server</span>
</pre></div>
</div>
<p>And that gets run within some loop.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">filename_to_save</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">some</span> <span class="n">function</span> <span class="n">of</span> <span class="n">the</span> <span class="n">url</span><span class="o">&gt;</span>
    <span class="n">one_search</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">filename_to_save</span><span class="p">)</span>
</pre></div>
</div>
<p>This structure is pretty adaptable depending on the nature of the problem and the input data you have that yields the list of URLs to visit.</p>
</div>
<div class="section" id="would-you-like-another-tutorial-to-try">
<h3>Would you like another tutorial to try?<a class="headerlink" href="#would-you-like-another-tutorial-to-try" title="Permalink to this headline">¶</a></h3>
<p>Again, Greg Reda has a nice <a class="reference external" href="https://nbviewer.jupyter.org/github/nealcaren/ScrapingData/blob/master/Notebooks/Bonus_Downloading.ipynb">walkthrough</a> discussing building a robust program to download a list and incorporating many of the elements we’ve talked about here.</p>
</div>
</div>
<div class="section" id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>STAT545, as always</p></li>
<li><p><a class="reference external" href="https://nealcaren.org/">Neal Caren</a></p></li>
</ul>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="mill"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><em>I’ve done well over a million API hits in the name of science.</em></p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Prof. Donald Bowen<br/>
        
            &copy; Copyright 2025.<br/>
          <div class="extra_footer">
            You're doing well, keep going!
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>